### 1. 記録編集画面

- 役割：指定日付の記録を読み込み、ユーザーが編集して上書き保存できる画面

- state（入力値）
  - threeLineDiary（3行日記の入力内容：文字列）
  - emotionalDump（感情吐き出しの入力内容：文字列）
  - mentalRate（メンタル評価の選択値：数値 or 未選択）
  - physicalRate（体力評価の選択値：数値 or 未選択）

- 操作・挙動（重要）
  - 初期表示
    - 遷移元で選択された日付（targetDate）を受け取る
    - targetDate をキーに、保存済みの「1日分レコード」を読み込む
    - 読み込み成功時：
      - レコードの各フィールドを state（入力値）に反映し、入力欄の初期値として表示する
      - 未入力の項目があれば空欄のまま表示（空欄OK）
    - 読み込み失敗 or データなし：
      - state（入力値）は空（未選択）として表示し、編集可能な状態にする（ユーザーを止めない）

  - 入力
    - 3行日記・感情吐き出しは自由入力（改行可）
    - メンタル/体力は選択で更新（未選択も許可＝未入力可方針）
    - 入力中は state（入力値）を更新し、画面表示へ即反映される

  - 保存
    - 「保存」押下で、targetDate のレコードを上書き保存する
    - 保存する内容は state（入力値）から組み立てる
      - 3行日記 / 感情吐き出し / メンタル評価 / 体力評価 を同一レコード内の別フィールドとして保持
    - 保存成功時：
      - トースト通知（例：「保存しました」）
      - 前画面へ戻る（記録詳細 or 記録一覧）
      - 戻り先では保存後の値で表示が更新されていること（再取得 or 画面更新で担保）
    - 保存失敗時：
      - トースト通知（例：「保存に失敗しました」）
      - 画面はそのまま残し、入力値（state）は維持する（再試行できる）

  - 戻る
    - 「戻る」操作で前画面へ戻る
    - 未保存確認ダイアログ：表示しない（未入力可・確認なし方針）
    - 未保存で戻った場合：保存されない（暗黙仕様）
    - ※必要なら「戻る＝破棄」と分かるUI（例：戻るボタンの位置・ラベル）で迷いを減らす

- データの扱い（保存単位）
  - 1日＝1レコードとして保存する（キーは日付）
  - 記録レコードは以下のような構造を想定（例）
    - date（YYYY-MM-DD）
    - threeLineDiary（string）
    - emotionalDump（string）
    - mentalRate（number | null）
    - physicalRate（number | null）
    - updatedAt（保存日時：任意）
  - 編集画面は常に「指定日付のレコード」を上書きする
  - 「今日のまとめ」と「感情吐き出し」は同一レコード内の別フィールドとして保持する

- バリデーション/制限（必要最低限）
  - 入力必須なし（全項目未入力でも保存可）
  - 文字数制限は当面なし（必要になったら後で追加）
  - 不正値は保存前に弾く（実装側でガード）
    - 例：評価が 1〜5 以外、NaN、負数 など
    - 未選択は null として保存（推奨）

- 例外/エラー時（最低限）
  - 読み込み失敗時：空欄として表示し編集可能（ユーザーを止めない）
  - 保存失敗時：トーストで失敗を通知し、入力値は保持（再試行可能）


### 2. 今日のまとめ（当日入力）

- 役割：当日の体調・メンタルを手軽に記録する入口画面（クイック入力）

- 性質
  - 新規入力の入口だが、実装上は「当日レコードの upsert（あれば更新／なければ作成）」
  - UI はモーダル表示だが、保存先は記録編集画面と同一のレコード

- 対象日
  - 当日固定（現在日付をキーとして扱う）

- state（入力値）
  - threeLineDiary（3行日記の入力内容）
  - mentalRate（メンタル評価の選択値）
  - physicalRate（体力評価の選択値）

- 操作・挙動
  - 初期表示
    - 当日の日付キーを生成する
    - 当日レコードを読み込み、存在すれば state に反映する
    - データが存在しない場合は、すべて未入力状態で表示する（空欄OK）
  - 入力
    - 3行日記は自由入力（改行可）
    - メンタル/体力は未選択も許可（未入力可方針）
  - 保存
    - 「保存」押下で当日レコードを部分更新（merge）で保存する
    - 更新対象は「今日のまとめ」に関するフィールドのみ
    - 他フィールド（感情吐き出し等）が存在する場合は保持する
    - 保存成功時：トースト通知（例：「保存しました」）
    - 保存後：モーダルを閉じ、ホーム画面の表示は保存後の値で更新されていること
  - 閉じる
    - 明示的な「閉じる」操作でモーダルを閉じる
    - 未保存確認ダイアログは表示しない（未入力可・確認なし方針）
    - 未保存の場合は保存されない（暗黙仕様）

- データの扱い
  - 保存単位は 1日＝1レコード
  - 当日の「今日のまとめ」は、レコード内の一部フィールドとして保持する
  - 保存時は必ず既存レコードを取得し、対象フィールドのみを更新する（部分更新）


### 3. 感情吐き出し（当日入力）

- 役割：当日の感情を自由に書き出す入口画面（クイック入力）

- 性質
  - 新規入力の入口だが、実装上は「当日レコードの upsert（あれば更新／なければ作成）」
  - UI はボトムシート表示

- 対象日
  - 当日固定（現在日付をキーとして扱う）

- state（入力値）
  - emotionalDump（感情吐き出しの入力内容）

- 操作・挙動
  - 初期表示
    - 当日の日付キーを生成する
    - 当日レコードを読み込み、存在すれば state に反映する
    - データが存在しない場合は空欄で表示する（空欄OK）
  - 入力
    - 感情吐き出しは自由入力（改行可）
  - 保存
    - 「保存」押下で当日レコードを部分更新（merge）で保存する
    - 更新対象は「感情吐き出し」フィールドのみ
    - 他フィールド（今日のまとめ等）が存在する場合は保持する
    - 保存成功時：トースト通知（例：「保存しました」）
    - 保存後：ボトムシートを閉じる
  - 閉じる
    - 明示的な「閉じる」操作でボトムシートを閉じる
    - 未保存確認ダイアログは表示しない（未入力可・確認なし方針）
    - 未保存の場合は保存されない（暗黙仕様）

- データの扱い
  - 保存単位は 1日＝1レコード
  - 感情吐き出しは、当日レコード内の一部フィールドとして保持する
  - 保存時は必ず既存レコードを取得し、対象フィールドのみを更新する（部分更新）
